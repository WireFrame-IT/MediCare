@if (isLoggedIn) {
  <div class="filter">
    <mat-form-field class="search">
      <input matInput type="text" placeholder="Search..." [(ngModel)]="search" (input)="applyFilter()" />
    </mat-form-field>
    <mat-form-field class="speciality">
      <mat-label>Speciality</mat-label>
      <mat-select [(ngModel)]="selectedSpecialityId" (selectionChange)="applyFilter()">
        <mat-option [value]="0">All specialities</mat-option>
        @for (speciality of specialityOptions; track speciality.value) {
          <mat-option [value]="speciality.value">
            {{ speciality.label }}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
    <mat-form-field class="status">
      <mat-label>Status</mat-label>
      <mat-select [(ngModel)]="selectedStatus" (selectionChange)="applyFilter()">
        <mat-option [value]="0">All statuses</mat-option>
        @for (speciality of statusOptions; track speciality.value) {
          <mat-option [value]="speciality.value">
            {{ speciality.label }}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
    <mat-form-field class="sort">
      <mat-label>Sort by...</mat-label>
      <mat-select [(ngModel)]="selectedSort" (selectionChange)="onSortChange()">
        @for (option of sortOptions; track option.value) {
          <mat-option [value]="option.value">
            {{ option.label }}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>
}
@if (filteredAppointments.length) {
  <div class="appointments-container">
    @for (appointment of filteredAppointments; track appointment.id) {
      <mat-card class="appointment-card">
        <mat-card-header class="header">
          <mat-card-title class="title">{{ appointment.service.name }}</mat-card-title>
          <mat-card-subtitle class="time">{{ appointment.time | date: 'yyyy-MM-dd HH:mm' }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content class="content">
          <button class="status" [class]="getStatusClass(appointment)" mat-raised-button>{{ getStatus(appointment) }}</button>
          @if (!isDoctor || canSeeAllAppointments()) {
            <div class="doctors-info">
              <p class="doctor-name">{{ appointment.doctor.user.name }} {{ appointment.doctor.user.surname }}</p>
              <i class="doctor-speciality">{{ appointment.doctor.speciality.name }}</i>
            </div>
          }
          @if (isDoctor || isAdmin) {
            <div class="patients-info">
              <p>{{ appointment.patient.user.name }} {{ appointment.patient.user.surname }}</p>
              <i>Patient</i>
            </div>
          }
        </mat-card-content>
        <mat-card-actions class="actions">
          @if (canCancel(appointment)) {
            <button mat-raised-button (click)="onCancel(appointment)">Cancel</button>
          }
          @if (isDoctor && canAccept(appointment)) {
            <button mat-flat-button (click)="onAccept(appointment)">Accept</button>
          }
          @if (isDoctor && canConfirm(appointment)) {
            <button mat-flat-button (click)="onConfirm(appointment)">Confirm</button>
          }
          @if (isConfirmed(appointment) && (isDoctor || (isAdmin || isRightUser(appointment)) && existsPrescription(appointment))) {
            <button mat-raised-button (click)="openPrescriptionDialog(appointment)">Prescription</button>
          }
          @if (isAdmin || isDoctor && isRightUser(appointment) && isConfirmed(appointment)) {
            <button mat-flat-button (click)="openEditAppointmentDialog(appointment)">{{ isAdmin ? "Edit" : "Diagnosis"}}</button>
          }
        </mat-card-actions>
      </mat-card>
    }
  </div>
}
@if (isLoggedIn && !filteredAppointments || filteredAppointments.length === 0) {
  <div class="no-appointments">
    <p>No appointments.</p>
    @if (!appointments || appointments.length === 0) {
      <button mat-flat-button routerLink="/services">See services</button>
    }
  </div>
}
